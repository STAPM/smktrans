<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smoking transition probability estimation • smktrans</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Smoking transition probability estimation">
<meta property="og:description" content="smktrans">
<meta property="og:image" content="https://stapm.gitlab.io/r-packages/smktrans/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-167990045-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-167990045-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">smktrans</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/smktrans.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Technical documentation</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://gitlab.com/stapm/r-packages/smktrans">
    <span class="fab fa fab fa-gitlab fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://stapm.gitlab.io/software.html">
    <span class="fa fa-code"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="smk_trans_prob_estimation_files/header-attrs-2.5/header-attrs.js"></script><script src="smk_trans_prob_estimation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="smk_trans_prob_estimation_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="smk_trans_prob_estimation_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Smoking transition probability estimation</h1>
            
      
      
      <div class="hidden name"><code>smk_trans_prob_estimation.Rmd</code></div>

    </div>

    
    
<p>This vignettes builds on our methodology report by explaining how to use the functions within the <code>smktrans</code> R package to produce estimates of the probabilities of smoking initiation and quit in England using data from the Health Survey for England. See <code><a href="../articles/clean_hse_data.html">vignette("clean_hse_data")</a></code> for an example of the code used to prepare the HSE data for use with these functions.</p>
<div id="smoking-initiation" class="section level2">
<h2 class="hasAnchor">
<a href="#smoking-initiation" class="anchor"></a>Smoking initiation</h2>
<p>For each cohort, we first estimate the age pattern of increase in the proportion of ever-smokers. This is done by the function <code><a href="../reference/init_est.html">smktrans::init_est()</a></code> - you can see its help file by typing <code><a href="../reference/init_est.html">?init_est</a></code>. The function takes the self-reported age that cigarettes were first smoked and constructs a vector of 0s, 1s and NAs corresponding to each age for each individual (1 = initiated smoking, NA = censored).</p>
<p>We constructed the variable for the age that cigarettes were first smoked from the HSE using the <code>hseclean</code> R package (see <code><a href="https://rdrr.io/pkg/hseclean/man/smk_life_history.html">hseclean::smk_life_history()</a></code>).</p>
<p>The <code><a href="../reference/init_est.html">smktrans::init_est()</a></code> function first calculates the cohort and strata specific mean of the 0s and 1s - which gives an estimate of the probability that someone from that cohort and strata initiated smoking at that age. The function then calculates the cumulative probability of starting to smoke by age.</p>
<p>The HSE data that the function is applied to should be cleaned in advance of using the <code>smktrans</code>. The cumulative probabilities of ever-smoking are then estimated by</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate the cumulative probabilities of starting to smoke for each cohort</span>
<span class="va">init_data_raw</span> <span class="op">&lt;-</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="fu"><a href="../reference/init_est.html">init_est</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">hse_data</span>,
  strat_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"imd_quintile"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div id="adjustment" class="section level3">
<h3 class="hasAnchor">
<a href="#adjustment" class="anchor"></a>Adjustment</h3>
<p>The main problem with these estimates is that they don’t correspond to the proportions of ever-smokers ascertained from asking respondents directly if they had ever smoked cigarettes regularly (this could be due to a range of factors e.g. recall bias or selective mortality). Developing the method used by Holford et al. <span class="citation">(<a href="#ref-holford2014patterns" role="doc-biblioref">2014</a>)</span>, we estimated and applied an adjustment factor to make these estimates correspond.</p>
<p>The first step in estimation of the adjustment factor is to estimate the proportions of ever-smokers at a certain index age from the question that asks directly about ever-smoking. This is done by the function <code><a href="../reference/ever_smoke.html">smktrans::ever_smoke()</a></code>. This function uses <code><a href="https://rdrr.io/pkg/survey/man/svyglm.html">survey::svyglm</a></code> to estimate the expected proportions of ever-smokers accounting for survey weights and the survey sampling design. We filter the data to only ages 25-34 years, and stratify the summary by cohort, sex and IMD quintile. The function then fits a survey weighted linear regression (quasibinomial) through the trends, which allows extrapolation to future cohorts.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estimate the trend in the proportion of people who have ever smoked</span>
<span class="co"># in the age range 25-34</span>
<span class="va">ever_smoke_data</span> <span class="op">&lt;-</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="fu"><a href="../reference/ever_smoke.html">ever_smoke</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">hse_data</span>,
  time_horizon <span class="op">=</span> <span class="fl">2200</span>,
  num_bins <span class="op">=</span> <span class="fl">7</span>,
  model <span class="op">=</span> <span class="st">"England"</span>
<span class="op">)</span></code></pre></div>
<p>The next step is to estimate the adjustment factor and apply the adjustment. This is done by the function <code><a href="../reference/init_adj.html">smktrans::init_adj()</a></code>. This function assigns a reference age to each cohort (default is 30 years). The adjustment factor is then calculated for each cohort and strata and applied to make the adjustment.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Adjust and forecast</span>
<span class="va">init_data_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init_adj.html">init_adj</a></span><span class="op">(</span>
  init_data <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">init_data_raw</span><span class="op">)</span>,
  ever_smoke_data <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">ever_smoke_data</span><span class="op">$</span><span class="va">predicted_values</span><span class="op">)</span>,
  ref_age <span class="op">=</span> <span class="fl">30</span>,
  cohorts <span class="op">=</span> <span class="fl">1971</span><span class="op">:</span><span class="fl">2100</span>,
  period_start <span class="op">=</span> <span class="fl">2001</span>, period_end <span class="op">=</span> <span class="fl">2016</span><span class="op">)</span></code></pre></div>
<p>Finally, we use the function <code><a href="../reference/p_dense.html">smktrans::p_dense()</a></code> to convert the probabilities of ever-smoking (the cumulative density function) into the probabilities of initiating smoking at each age.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smk_init_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/p_dense.html">p_dense</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">init_data_adj</span><span class="op">)</span>, cum_func_var <span class="op">=</span> <span class="st">"p_ever_smoker_adj"</span>,
                     strat_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cohort"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For our modelling of smoking dynamics, we want initiation probabilities for ages up to 30 years (after which we assume no new initiation) for each period modelled from 2001 onwards.</p>
</div>
</div>
<div id="relapse-to-smoking" class="section level2">
<h2 class="hasAnchor">
<a href="#relapse-to-smoking" class="anchor"></a>Relapse to smoking</h2>
<p>We consider the probability of relapse to smoking by former smokers from 1 to 10 years since quitting, which we call long-term relapse. To estimate these probabilities, we combine published estimates of long-term relapse from Hawkins et al. <span class="citation">(<a href="#ref-hawkins2010long" role="doc-biblioref">2010</a>)</span> with the Health Survey for England data. We do this in the function <code><a href="../reference/prep_relapse.html">smktrans::prep_relapse()</a></code>.</p>
<p>Hawkin’s statistical analysis adjusts for several covariates. We only adjust for a subset of these covariates as detailed below:</p>
<ul>
<li>age - a continuous function<br>
</li>
<li>sex<br>
</li>
<li>time since quit - 1, 2, 3, 4, 5, 6+ years<br>
</li>
<li>degree or not<br>
</li>
<li>employed or not<br>
</li>
<li>married, cohabiting or neither<br>
</li>
<li>mental health condition or not<br>
</li>
<li>income - we mapped Hawkins income quartiles to equivalised income quintiles from the HSE by pooling the lowest two income quintiles.</li>
</ul>
<p>Note that Hawkins found that physical health / GP visits also explained statistically significant variation in smoking relapse but we were not able to adjust for them due to a lack of corresponding variables in the Health Survey for England.</p>
<p>The first step is to assign each former smoker in the HSE an expected probability of relapse based on the matching on the time since quit and the covariates above. The second step is to calculate weighted averages of the relapse probability for subgroups defined by either age, sex and IMD quintile (to feed into our estimation of quit probabilities) or age, sex, IMD quintile and time since quit (to feed into our simulation of individual smoking histories).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Combine published estimates of long-term relapse with the Health Survey for England data to arrive at the expected values for relapse probabilities within defined subgroups.</span>
<span class="va">relapse_data</span> <span class="op">&lt;-</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="fu"><a href="../reference/prep_relapse.html">prep_relapse</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">hse_data</span>,
  hawkins_relapse <span class="op">=</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="va"><a href="../reference/hawkins_relapse.html">hawkins_relapse</a></span>,
  lowest_year <span class="op">=</span> <span class="fl">2001</span>,
  highest_year <span class="op">=</span> <span class="fl">2016</span>,
  youngest_age <span class="op">=</span> <span class="fl">11</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="quitting-smoking" class="section level2">
<h2 class="hasAnchor">
<a href="#quitting-smoking" class="anchor"></a>Quitting smoking</h2>
<p>The age-specific probabilities that a smoker will quit smoking are complex to estimate due to an number of potential biases. The formula we derived (see accompanying article) uses the probabilities of initiation and relapse. It also uses the following inputs:</p>
<div id="proportions-of-current-former-and-never-smokers" class="section level3">
<h3 class="hasAnchor">
<a href="#proportions-of-current-former-and-never-smokers" class="anchor"></a>Proportions of current, former and never smokers</h3>
<p>We statistically smooth the HSE trends over age and year in the proportions of current, former and never smokers, using the function <code><a href="../reference/trend_fit.html">smktrans::trend_fit()</a></code>. This fits a multinomial linear model to the distribution of people among current, former and never smoking status, and in this model estimates the variation in trends by sex and socioeconomic conditions in terms of quintiles of the Index of Multiple Deprivation. The model has a logit link function and accounts for the HSE survey weights. Age and year were converted to z-scores (subtracting their mean and dividing by twice their standard deviation) before model fitting.</p>
<p>The explanatory variables for age <span class="math inline">\(a\)</span> and year <span class="math inline">\(y\)</span> are specified in the form of a cubic response surface, which has the form <span class="math inline">\(a+a^2+y+y^2+ay + a^3 + y^3+a^2y+ay^2\)</span>. We added an additional 4th order term for age <span class="math inline">\(a^4\)</span> to better capture the non-linear patterns over age e.g. as individuals initiate and then quit with age.</p>
<p>Interactions of this surface with sex and IMD quintiles are limited to 3rd order terms. Interactions with the quadratic term are included for age but not for year to avoid over-fitting variation in the trend over years, which is more of a linear change than the pattern over age. The decision to do so was made after visually exploring the fit of simpler and more complex model specifications to the data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># model trends in current, former and never smoking</span>
<span class="va">trend_data</span> <span class="op">&lt;-</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="fu"><a href="../reference/trend_fit.html">trend_fit</a></span><span class="op">(</span><span class="va">hse_data</span>,
  max_iterations <span class="op">=</span> <span class="fl">1e3</span>,
  age_var <span class="op">=</span> <span class="st">"age"</span>,
  year_var <span class="op">=</span> <span class="st">"year"</span>,
  sex_var <span class="op">=</span> <span class="st">"sex"</span>,
  smoker_state_var <span class="op">=</span> <span class="st">"smk.state"</span>,
  imd_var <span class="op">=</span> <span class="st">"imd_quintile"</span>,
  weight_var <span class="op">=</span> <span class="st">"wt_int"</span><span class="op">)</span></code></pre></div>
</div>
<div id="cohort-survivorship" class="section level3">
<h3 class="hasAnchor">
<a href="#cohort-survivorship" class="anchor"></a>Cohort survivorship</h3>
<p>We approximating the number of individuals alive at each age within each cohort with the cohort survivorship function, which is the probability that an individual will survive to the start of each age interval. We get these data into the right format with the function <code><a href="../reference/prep_surv.html">smktrans::prep_surv()</a></code>.</p>
<p>The function <code><a href="../reference/prep_surv.html">smktrans::prep_surv()</a></code> calculates the cohort survivorship function over age, i.e. the probability that someone from each cohort will survive to the start of each 1 year age interval, stratified by sex and IMD quintile.</p>
<p>The function takes two data sources as inputs:</p>
<ul>
<li>Data from 1922 from the <a href="https://www.mortality.org/cgi-bin/hmd/country.php?cntr=GBRCENW&amp;level=1">Human Mortality Database</a> on the 1x1 age and period central death rates (mx) for the England &amp; Wales civilian population. Death rates are stratified by sex only. We use the HMD data to estimate sex-specific survivorship curves from age 12 onwards for each cohort that features in our 2001-2016 window.<br>
</li>
<li>Death rates from 2001-2016 for England by age, sex, year and IMD quintile. These are data that we have produced from the Office for National Statistics (ONS) mortality microdata (the processing of these data is done by the <code>mort.tools</code> R package and the data is stored on our virtual machine). We use the ONS data to inform the differences by IMD quintile in the age- and sex-specific probabilities of surviving through each 1 year age interval for years 2001-2016.</li>
</ul>
<p><code><a href="../reference/prep_surv.html">smktrans::prep_surv()</a></code> calculates survivorship curves that are only partially stratified by IMD quintile (because we do not use data on IMD quintile differences in survival before 2001). This partial stratification is sufficient for our calculation because the formula uses the ratios of people alive at age <span class="math inline">\(a+1\)</span> compared to age <span class="math inline">\(a\)</span>, i.e. the important thing is that we have reliably characterised the shapes of the survivorship functions from 2001 to 2016 for each cohort, sex and IMD quintile.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estimate the shape of the cohort survivorship functions</span>
<span class="va">survivorship_data</span> <span class="op">&lt;-</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="fu"><a href="../reference/prep_surv.html">prep_surv</a></span><span class="op">(</span>
  mx_data_hmd <span class="op">=</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="va"><a href="../reference/hmd_data.html">hmd_data</a></span>,
  mx_data_ons <span class="op">=</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="va">tob_mort_data</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="survival-by-smoking-status" class="section level3">
<h3 class="hasAnchor">
<a href="#survival-by-smoking-status" class="anchor"></a>Survival by smoking status</h3>
<p>We estimated the age-specific probabilities of surviving from age <span class="math inline">\(a\)</span> to age <span class="math inline">\(a+1\)</span>, stratified by sex, IMD quintile and smoking status (current, former, never regular cigarette smoker). These estimates are used to adjust the probability of quitting smoking for the mortality differentials by smoking status. The estimation of survival by smoking status is done in the function <code><a href="../reference/smoke_surv.html">smktrans::smoke_surv()</a></code>.</p>
<p>We do not use individually-linked data that has smoking status linked to time of death. Instead, we infer the mortality differentials by smoking status based on the relative differences in risks for smoking-related diseases among current, former and never smokers. To make these calculations, <code><a href="../reference/smoke_surv.html">smktrans::smoke_surv()</a></code> calls the functions <code><a href="https://rdrr.io/pkg/tobalcepi/man/RRFunc.html">tobalcepi::RRFunc()</a></code> and <code><a href="https://rdrr.io/pkg/stapmr/man/SurvFunc.html">stapmr::SurvFunc()</a></code>. Data on the relative risks of disease by smoking status and the rates of death for each smoking-related disease are also taken from the data stored in the other packages.</p>
<p><code><a href="https://rdrr.io/pkg/tobalcepi/man/RRFunc.html">tobalcepi::RRFunc()</a></code> assigns the relative risk for each disease based on whether an individual is a current, former or never smoker. All current smokers have the same relative risk regardless of the amount they currently smoke or have smoked in the past. Former smokers are initially given the relative risk associated with current smokers, which we then scale according to a disease-specific function that describes how risk declines after quitting smoking.</p>
<p><code><a href="https://rdrr.io/pkg/stapmr/man/SurvFunc.html">stapmr::SurvFunc()</a></code> computes the individual probability of death based on each individual’s relative risks of disease and the mortality rates for each disease for each sex and IMD quintile subgroup. The result is individual specific mortality rates that average to the subgroup rate. The mortality rates are then converted to the probability of death during the one-year age interval exponentially during the age-interval. Probabilities of death are summed across causes to give an overall probability of death.</p>
<p><code><a href="../reference/smoke_surv.html">smktrans::smoke_surv()</a></code> takes these estimated probabilities of death and fits a smooth line through the age pattern for each year, sex, IMD quintile and smoking status. The values of this smoothed fit are converted to the probabilities of surviving from age <span class="math inline">\(a\)</span> to age <span class="math inline">\(a+1\)</span>, stratified by sex, IMD quintile and smoking status.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estimate age-specific probabilities of death by smoking status</span>
<span class="va">mortality_data</span> <span class="op">&lt;-</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="fu"><a href="../reference/smoke_surv.html">smoke_surv</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">hse_data</span>,
  diseases  <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="fu">tobalcepi</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/tobalcepi/man/tobacco_relative_risks.html">tobacco_relative_risks</a></span><span class="op">$</span><span class="va">condition</span><span class="op">)</span>,
  mx_data <span class="op">=</span> <span class="fu">stapmr</span><span class="fu">::</span><span class="va">tob_mort_data_cause</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="quit-probability-calculation" class="section level3">
<h3 class="hasAnchor">
<a href="#quit-probability-calculation" class="anchor"></a>Quit probability calculation</h3>
<p>Quit probabilities are calculated by the function <code><a href="../reference/quit_est.html">smktrans::quit_est()</a></code>, which applies the equation we derived (see article) using the parameter estimates above. The result is probabilities of quitting smoking stratified by single years of age (11-88) and period (2001-2015), sex and IMD quintile.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate quit probabilities</span>
<span class="va">quit_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quit_est.html">quit_est</a></span><span class="op">(</span>
  dataq <span class="op">=</span> <span class="va">hse_data</span>,
  trend_dataq <span class="op">=</span> <span class="va">trend_data</span>,
  survivorship_dataq <span class="op">=</span> <span class="va">survivorship_data</span>,
  mortality_dataq <span class="op">=</span> <span class="va">mortality_data</span><span class="op">$</span><span class="va">data_for_quit_ests</span>,
  relapse_dataq <span class="op">=</span> <span class="va">relapse_data</span><span class="op">$</span><span class="va">relapse_by_age_imd</span>,
  initiation_dataq <span class="op">=</span> <span class="va">smk_init_data</span>,
  lowest_yearq <span class="op">=</span> <span class="fl">2001</span>,
  highest_yearq <span class="op">=</span> <span class="fl">2016</span>,
  youngest_yearq <span class="op">=</span> <span class="fl">11</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="quit-probability-smoothing-and-forecast" class="section level3">
<h3 class="hasAnchor">
<a href="#quit-probability-smoothing-and-forecast" class="anchor"></a>Quit probability smoothing and forecast</h3>
<p>The function <code><a href="../reference/quit_forecast.html">smktrans::quit_forecast()</a></code> is applied separately to each sex and IMD quintile. It first smooths the pattern in the quit probabilities (a 2-dimensional moving average, where the values considered form a 7-year-square over the single years of age and period). As well as smoothing the trends, this also acts to fill-in missing values based on the information in their neighbouring values by age and period. We fill-in any remaining missing values by approximating the age-specific trend over periods.</p>
<p>Second, the function forecasts the trend in the quit probabilities based on an singular value decomposition (of logit transformed probabilities). This produces a single vector to describe the trend over period, which we project forwards based on the fit of a linear model to data from a selected year onwards (<code>first_year</code>). The decomposition also estimates the age-emphasis of this change i.e. whether the change is relatively fasters at young or old ages - we fit a linear slope through this age-pattern of change. The forecast is based on recombining these two components to predict the trend in future years.</p>
<p><code><a href="../reference/quit_forecast.html">smktrans::quit_forecast()</a></code> has options to adjust the reference years and time horizon. It also has an option to specify the future year at which the continuing trend in quit probabilities switches from continuing to stationary (in case you want to use this function to play with the forecast scenario, but this might be more easily done outside of the function).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">forecast_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quit_forecast.html">quit_forecast</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">quit_data</span><span class="op">)</span>,
  forecast_var <span class="op">=</span> <span class="st">"p_quit"</span>,
  forecast_type <span class="op">=</span> <span class="st">"continuing"</span>, <span class="co"># continuing or stationary</span>
  cont_limit <span class="op">=</span> <span class="fl">2030</span>, <span class="co"># the year at which the forecast becomes stationary</span>
  first_year <span class="op">=</span> <span class="fl">2007</span>, <span class="co"># the earliest year of data on which the forecast is based</span>
  jump_off_year <span class="op">=</span> <span class="fl">2015</span>,
  time_horizon <span class="op">=</span> <span class="fl">2030</span>
<span class="op">)</span></code></pre></div>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references hanging-indent">
<div id="ref-hawkins2010long">
<p>Hawkins, James, William Hollingworth, and Rona Campbell. 2010. “Long-Term Smoking Relapse: A Study Using the British Household Panel Survey.” <em>Nicotine &amp; Tobacco Research</em> 12 (12): 1228–35.</p>
</div>
<div id="ref-holford2014patterns">
<p>Holford, Theodore R, David T Levy, Lisa A McKay, Lauren Clarke, Ben Racine, Rafael Meza, Stephanie Land, Jihyoun Jeon, and Eric J Feuer. 2014. “Patterns of Birth Cohort–Specific Smoking Histories, 1965–2009.” <em>American Journal of Preventive Medicine</em> 46 (2): e31–e37.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/gillespie_d">Duncan Gillespie</a>, Laura Webster, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/brennan_a">Alan Brennan</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
