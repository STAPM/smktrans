<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Forecast relapse probabilities — relapse_forecast • smktrans</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Forecast relapse probabilities — relapse_forecast"><meta property="og:description" content="Produces future projections of the annual probabilities of relapse by former smokers,
stratified by age, sex, IMD quintile and the number of years since quitting (up to 10 years)."><meta property="og:image" content="https://stapm.gitlab.io/r-packages/smktrans/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-167990045-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-167990045-1');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">smktrans</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/smktrans.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Technical documentation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/smk_trans_prob_estimation.html">Estimation workflow</a>
    </li>
    <li>
      <a href="../articles/smoking_transition_probabilities_modelling_report.pdf">Methods notes: Smoking state transition probability estimation</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/STAPM/smktrans" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://gitlab.com/stapm/r-packages/smktrans" class="external-link">
    <span class="fab fa-gitlab fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://stapm.gitlab.io/software.html" class="external-link">
    <span class="fa fa-code"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Forecast relapse probabilities</h1>
    
    <div class="hidden name"><code>relapse_forecast.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Produces future projections of the annual probabilities of relapse by former smokers,
stratified by age, sex, IMD quintile and the number of years since quitting (up to 10 years).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">relapse_forecast</span><span class="op">(</span></span>
<span>  <span class="va">relapse_forecast_data</span>,</span>
<span>  <span class="va">relapse_by_age_imd_timesincequit</span>,</span>
<span>  jump_off_year <span class="op">=</span> <span class="fl">2018</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>relapse_forecast_data</dt>
<dd><p>Data table - the output from <code><a href="quit_forecast.html">quit_forecast()</a></code>.</p></dd>


<dt>relapse_by_age_imd_timesincequit</dt>
<dd><p>Data table - the output from <code><a href="prep_relapse.html">prep_relapse()</a></code> 
that has the relapse probabilities stratified by age, sex, IMD quintile and time since quitting.</p></dd>


<dt>jump_off_year</dt>
<dd><p>integer - the last year of observed data.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns a data.table of past and future relapse probabilities 
stratified by age, sex, IMD quintile and time since quitting.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>It is difficult to reliably forecast values that are stratified by age, sex, IMD quintile and 
time since quitting due to the high dimensionality of these data. 
We therefore forecast the values stratified by age, sex and IMD quintile, 
and from these forecasts calculate scaling values that 
are then applied to the relapse probabilities estimated from the last year of observed data 
to produce forecasts stratified by age, sex, IMD quintile and 
time since quitting.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Combine published estimates of long-term relapse with </span></span></span>
<span class="r-in"><span><span class="co"># the Health Survey for England data to arrive at the expected values </span></span></span>
<span class="r-in"><span><span class="co"># for relapse probabilities within defined subgroups.</span></span></span>
<span class="r-in"><span><span class="va">relapse_data</span> <span class="op">&lt;-</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="fu"><a href="prep_relapse.html">prep_relapse</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">hse_data</span>,</span></span>
<span class="r-in"><span>  hawkins_relapse <span class="op">=</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="va"><a href="hawkins_relapse.html">hawkins_relapse</a></span>,</span></span>
<span class="r-in"><span>  lowest_year <span class="op">=</span> <span class="fl">2001</span>,</span></span>
<span class="r-in"><span>  highest_year <span class="op">=</span> <span class="fl">2018</span>,</span></span>
<span class="r-in"><span>  youngest_age <span class="op">=</span> <span class="fl">11</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Forecasting relapse probabilities is tricky because </span></span></span>
<span class="r-in"><span><span class="co"># the probabilities that are used in the model are stratified by age, sex, IMDq and time since quitting</span></span></span>
<span class="r-in"><span><span class="co"># The approach will be to forecast the version of the probabilities stratified by age, sex and IMDq only</span></span></span>
<span class="r-in"><span><span class="co"># and then use the results to scale the higher dimensional version</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">relapse_forecast_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="quit_forecast.html">quit_forecast</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">relapse_data</span><span class="op">$</span><span class="va">relapse_by_age_imd</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  forecast_var <span class="op">=</span> <span class="st">"p_relapse"</span>,</span></span>
<span class="r-in"><span>  forecast_type <span class="op">=</span> <span class="st">"continuing"</span>, <span class="co"># continuing or stationary</span></span></span>
<span class="r-in"><span>  cont_limit <span class="op">=</span> <span class="fl">2030</span>, <span class="co"># the year at which the forecast becomes stationary</span></span></span>
<span class="r-in"><span>  first_year <span class="op">=</span> <span class="fl">2001</span>, <span class="co"># the earliest year of data on which the forecast is based</span></span></span>
<span class="r-in"><span>  jump_off_year <span class="op">=</span> <span class="fl">2018</span>,</span></span>
<span class="r-in"><span>  time_horizon <span class="op">=</span> <span class="fl">2100</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot to check</span></span></span>
<span class="r-in"><span><span class="va">relapse_forecast_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">relapse_forecast_data</span><span class="op">[</span><span class="va">age</span> <span class="op">==</span> <span class="fl">50</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2030</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">p_relapse</span>, colour <span class="op">=</span> <span class="va">imd_quintile</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"P(relapse)"</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span>  <span class="co">#ylim(0, 1) +</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">2018</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">relapse_forecast_plot</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu">relapse_forecast</span><span class="op">(</span></span></span>
<span class="r-in"><span>  relapse_forecast_data <span class="op">=</span> <span class="va">relapse_forecast_data</span>,</span></span>
<span class="r-in"><span>  relapse_by_age_imd_timesincequit <span class="op">=</span> <span class="va">relapse_data</span><span class="op">$</span><span class="va">relapse_by_age_imd_timesincequit</span>,</span></span>
<span class="r-in"><span>  jump_off_year <span class="op">=</span> <span class="fl">2018</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/gillespie_d" class="external-link">Duncan Gillespie</a>, Laura Webster, Grace Leeming, Magdalena Opazo-Breton, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/brennan_a" class="external-link">Alan Brennan</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

